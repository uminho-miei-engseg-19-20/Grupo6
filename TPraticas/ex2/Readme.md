# Exercício 2

Este exercício possui como objetivo compreender a fragmentação de um segredo por um conjunto de componentes de forma a que individualmente
nenhum elemento consiga descodificar o segredo com apenas a informação que possui.  
De forma a explicar a resolução, de seguida é demonstrada as experiências efectuadas, assim, será facilitada a compreensão da resolução das questões.  

## Experiência 2.1

### Como executar uma script php

- `php -f <YourScriptHere.php>`

### Testes efectuados

Um dos primeiros testes que o grupo decidiu efectuar é a ***execução da script duas vezes*** de forma a testar a obtenção do mesmo resultado.  

```
php -f genSharedSecret.php "ola tudo bem" 3

Código 0: 111001111110100000111101011001101110010000001011100100000101111010111110010001101110011110000111
Código 1: 111101010010011000011110000010010011011101110100001001100010100010010100001100010111010000100001
Código 3: 011111011010001001000010010011111010011100001010110100100001100100001010000101011111011011001011

php -f genSharedSecret.php "ola tudo bem" 3
Código 0: 001011101100010000111111110101000010101101010011111001111110101010010111100101011101011000010110
Código 1: 101111111010011110111111111110110010110101000101010010101000101100001111011010100111101011010101
Código 3: 111111100000111111100001000011110111001001100011110010010000111010111000100111011100100110101110

```
Como pode ser observado, ***não ocorre a geração do mesmo resultado*** em duas execuções repetidas. São gerados três códigos como esperado e cada um deles é ***constituído por 96 dígitos***.  

### Tentativa de reconstituição

De forma a testar a reconstituição do segredo, o grupo decidiu gerar um novo segredo e testar ***quantas componentes são necessárias para descodificar*** o segredo criptografico.  

A seguinte secção descreve o teste realizado pelo grupo.  

#### Geração do segredo
```
php -f genSharedSecret.php "jesus cristo" 7
Código 0: 110000011000000010110001010110000100001110101101111000010111000100010110110100110110011110100000
Código 1: 100001101011111010111011000111101011100110010111111011111001000100111111111110010111011111011111
Código 2: 001000110001110001100101100101011101110100010011111110011111011010110101011110001100111001010011
Código 3: 110110011000110011000110011010010100110111111100110111000111101100000010001110111000010101110010
Código 4: 011100011000000001000000001010010011011110011000100000001100000011101100010110101011010011011111
Código 5: 100010100000001100111000110000011000011001111001110010111101011010001010101001111011111010010110
Código 7: 001011000100100010100010001001111010100000010100000000110000100110010001111001110010010101111000
```
#### Tentativas de reconstituição

```
Apenas código 0:
php -f reconstroiSecret.php 110000011000000010110001010110000100001110101101111000010111000100010110110100110110011110100000
Segredo: ���XC��q�g�

Código 0+1:
php -f reconstroiSecret.php 110000011000000010110001010110000100001110101101111000010111000100010110110100110110011110100000 100001101011111010111011000111101011100110010111111011111001000100111111111110010111011111011111
Segredo: G>
F�:�)*

Código 0+1+2:
php -f reconstroiSecret.php 110000011000000010110001010110000100001110101101111000010111000100010110110100110110011110100000 100001101011111010111011000111101011100110010111111011111001000100111111111110010111011111011111 001000110001110001100101100101011101110100010011111110011111011010110101011110001100111001010011
Segredo: d"o�')��R�,


Código 0+1+2+3:
php -f reconstroiSecret.php 110000011000000010110001010110000100001110101101111000010111000100010110110100110110011110100000 100001101011111010111011000111101011100110010111111011111001000100111111111110010111011111011111 001000110001110001100101100101011101110100010011111110011111011010110101011110001100111001010011 110110011000110011000110011010010100110111111100110111000111101100000010001110111000010101110010
Segredo: ����j�+m�i[^


Código 0+1+2+3+4:
php -f reconstroiSecret.php 110000011000000010110001010110000100001110101101111000010111000100010110110100110110011110100000 100001101011111010111011000111101011100110010111111011111001000100111111111110010111011111011111 001000110001110001100101100101011101110100010011111110011111011010110101011110001100111001010011 110110011000110011000110011010010100110111111100110111000111101100000010001110111000010101110010 011100011000000001000000001010010011011110011000100000001100000011101100010110101011010011011111
Segredo: �.�]M��r3�


Código 0+1+2+3+4+5:
php -f reconstroiSecret.php 110000011000000010110001010110000100001110101101111000010111000100010110110100110110011110100000 100001101011111010111011000111101011100110010111111011111001000100111111111110010111011111011111 001000110001110001100101100101011101110100010011111110011111011010110101011110001100111001010011 110110011000110011000110011010010100110111111100110111000111101100000010001110111000010101110010 011100011000000001000000001010010011011110011000100000001100000011101100010110101011010011011111 100010100000001100111000110000011000011001111001110010111101011010001010101001111011111010010110
Segredo: F-�R�4`{�Q

Código 0+1+2+3+4+5+7:
php -f reconstroiSecret.php 110000011000000010110001010110000100001110101101111000010111000100010110110100110110011110100000 100001101011111010111011000111101011100110010111111011111001000100111111111110010111011111011111 001000110001110001100101100101011101110100010011111110011111011010110101011110001100111001010011 110110011000110011000110011010010100110111111100110111000111101100000010001110111000010101110010 011100011000000001000000001010010011011110011000100000001100000011101100010110101011010011011111 100010100000001100111000110000011000011001111001110010111101011010001010101001111011111010010110 001011000100100010100010001001111010100000010100000000110000100110010001111001110010010101111000
Segredo: jesus cristo
 ```

Como podemos concluir, ***apenas com a presença de todas as componentes***, será possível a descodificação da mensagem.  

## Experiência 2.2

A experiência 2.2 possui como alternativa, demostrar a possibilidade de descodificar um segredo ***sem a presença de todas as componentes*** geradas.  
De forma exemplificativa, o grupo gerou um segredo com ***7 componentes*** e para a sua descodificação só será necessária a presença de ***5 componentes***.  

#### Gerar o segredo

```
perl shares.pl 5 7
ola tudo bem
5:1:811ac76fc30e4f306c7523df:
5:2:g03e9ba97da1028311719932:
5:3:cb6a56e39025336d18f83a3f:
5:4:9c7c72152c1ed141f53b340e:
5:5:059e691ec798039f85006cdb:
5:6:7345b7bf17272e72149d7f10:
5:7:2933d89c1aeceef459f8c34e:
```

#### Decifrar o segredo
```
perl reconstruct.pl
5:1:811ac76fc30e4f306c7523df:
5:6:7345b7bf17272e72149d7f10:
5:4:9c7c72152c1ed141f53b340e:
5:3:cb6a56e39025336d18f83a3f:
5:2:g03e9ba97da1028311719932:
(ctrl-d)
ola tudo bem
```
Como foi demonstrado, é possível a descodificação do segredo sem a presença de todas as componentes.  


## Exercício 2.1 A)

A resolução deste exercício é semelhante à ***experiência 2.2*** demonstrada anteriormente, ou seja, a reconstituição de um segredo a partir de um conjunto de componentes.  

### Processo de Resolução
- Instalação do modulo ***eVotUM.Cripto***(https://gitlab.com/eVotUM/Cripto-py) e respectivas dependencias
- Obter o User Id, por exemplo com a execução do comando ```id -u```
- Gerar uma chave privada ```openssl genrsa -aes128 -out private-key.pem 1024```, necessária na geração das componentes a partilhar
- Gerar o respectivo certificado ```openssl req -key private-key.pem -new -x509 -days 365 -out mykey.crt```, necessário para descodificar a mensagem

### Exemplo de execução
#### Gerar as componentes do segredo
Com a execução do comando ```python createSharedSecret-app.py 8 5 501 private-key.pem``` é possível gerar um ***segredo com 8 componente*** onde ***apenas 5 componentes*** são necessárias na sua reconstituição.  

```
python createSharedSecret-app.py 8 5 501 private-key.pem

Private key passphrase: passwordmuitoforte

Secret: Agora temos um segredo extremamente confidencial


Component: 1
eyJhbGciOiAiUlMyNTYifQ.eyJvYmplY3QiOiBbIjEtYmFmZDc5YjE5MmY1ZDY5Y2U3NGVkNmU4MzhlOTY5ODgwZTFiZDNjMmQ1NTY1ODRjMmViODM5Y2QyMGY1YmM0YTRkOGY5MmE3NWJkZTUyMzMwMTNkMzM0ZDFiMzYwZDdkIiwgIjUwMSIsIDUsIDgsICIwZDA5YTNlNWEzNjFhYzA2MzJkMDM3NzhiOTcyNzQ3OTVhMmM4ZDJhMzM3ZDM5ODE4NTkyOWQ4ZTNiMWRkZjhiIl19.wAqoYNCZsV1q3-lqBqNzYB3QuRIPJSZyA8EKI0yxUV3nBlbaKtipvGRV0XQga6Fy1U-yNsZY08Pul-vBFcdN5IfsLnRaOnuoyjQfPXQ9v5B6kKKj7Jj_doC_FpWzciIoYQNHJhO19lq3VbYVm-i3o_FyRLnGvtiLLVTyZ-5PjU0
Component: 2
eyJhbGciOiAiUlMyNTYifQ.eyJvYmplY3QiOiBbIjItOWIxNzkwMGFiZDJlYTJmOWRlNDQ2N2U2ZDg1ZmM3ZWM0NWU4YzdiZjQzM2U4NGFiZDY1ZjJjZjJlMDFlZmFhZTJiNWVmNWE1YTM5ZmM4YmRmMjRhZmFmNzM5ZjdjN2M3IiwgIjUwMSIsIDUsIDgsICJmNTU5YTUzNWU2NGY5YzA0ZjE5MGY2NmMwZjczNTQyNzcyMTg3NDA3ZGI2NzQyNWJlMjg1ZjU4OGI2Y2E4MGE5Il19.vKhPraJPs0nCRo7ccZXSYLPNNI90j8hm6TY_MKqvOsnmVrtTW_rloexqtZ5wY1rCd5RWpPLTZ9QalwBIDj5yGXF4nZnW4a-aVVvzcoOAbjeb3UtC9qWVNvIRssgjs5avqAkdJI4abfer8vHWOOXyB3wHKGxSzcyTJbY7QTiCjxo
Component: 3
eyJhbGciOiAiUlMyNTYifQ.eyJvYmplY3QiOiBbIjMtZGI4YWQ0NzA3MGIzNWZlNGM3YTBhZTNlMDY5NDE1OTExM2I2YzJhNzZlMTI1NmUwNTcwOTNjYzhmYzE4MDk3ZmQxNzgyYmUwNTkzZDc1MGU4YzBlZTlmNDIwYTUyOWU2IiwgIjUwMSIsIDUsIDgsICJhODdlNWNhOTRkYjZjYjFjMjE2OWFlNmNjM2RiOGI3NDEwZjIyY2Y2OTllZGY3ODNkZGNhNjY4ODlkY2U3Y2Q3Il19.FzhGt90Kel9SHlcY4yXWkJ_Ghzf4YpqK2lwoK5y-ULyJEobDHv0LOO4nY7Am5ZI0SLyJ4q7Tcs_jZNn82KwBIrPFxmws7bKGzFzLisW5YIrOLqLkvO_4NIlfPXh8rgYq3jY9qHsKHvnCAZrXSy4-5nFqpNSp8v_XSv5nWbRSYGE
Component: 4
eyJhbGciOiAiUlMyNTYifQ.eyJvYmplY3QiOiBbIjQtMWNmMTlhYmVhNjA3ODRhMmE0MzY1YWZjYmRhNjU2ZTM2OTZlNGY0MTc4NmVjYWUwNjRjM2ZlOTE2MGJlNDgzMjY3MjIyMGNkZmZiOGUzMDUzZWQwNGQzZmJkZmVmNWVlIiwgIjUwMSIsIDUsIDgsICI2ZGM1MDAxMDlhNWYzOTY5ZjcxMzlkYTAxOTNhZGZmOWNlYWYwMDYxZWY2Y2NjYzEyM2FmMDBlOWI0ZmRkNzViIl19.ck4uDZaj0NedxbG6R15W7yEFORzTciX20dMdCC7VoNtEgv4ool-D0V4DhnehPSMvjuwjtUwrXCRXezjpBVGIPBpsMAM_8ALaeXzrOa9rLAzAMqsvqLt40THE-yHipKVRGoRoDGSTooto3GeE0R7oCXth_XR7-8a0NcRCgdzP-AA
Component: 5
eyJhbGciOiAiUlMyNTYifQ.eyJvYmplY3QiOiBbIjUtYTZhYjY4YmFiZDQ5Nzk1NTAwNWE0ODFmM2YxMmJhY2MyM2Y4MGVjY2U3YTMyNzNkODAwYWFiZGQ5NDkxOTRiZDcxNTUwZDk2N2U4Yjg3NWI5YjljOTE0YThlOTAxYmQ1IiwgIjUwMSIsIDUsIDgsICIyMzY1NzFmMTk5ZTUzMDAwMTY4Y2IzYTk4MDI0MjRmYWZiZjFiNjNhMDZjZTkzOTE2Y2JhYTMxZjIxMmUyMTg2Il19.JRn5T2MA0KVfsuKARodFUhLP68b8CwcHQzHasSy6LW7ptC_PMrsag9HTNPORKzepq4ktWMpt0KCCOUJW6HpgUPT7zuNVneWgd8aOfrBQHr1lC809CnpN3pjg_JqP9H-8sNWdns17DYmkcTYTvAimOHSrNDfjj4LMH9ktSSWMLe4
Component: 6
eyJhbGciOiAiUlMyNTYifQ.eyJvYmplY3QiOiBbIjYtNjZkY2Y2MTM3ZTMyOTZmOWYzZTM3ODhmMTNiMTlhYjAwYjNjYjkwMmEzYjBmZDIzZjVjNjIyOGViOGI0NGI5Y2QyYmE3OTEzMjFhNmJmYTQ1NDQ3NDFmOTljYWRiMjNiIiwgIjUwMSIsIDUsIDgsICIyZjQxZTVjNjJmODNhODJkMDExOTIzN2I2YWI5MTlkNDRhNTNjMjc4M2VlMTBlZmViZGZhZmY4OTA1N2EzZjFhIl19.tVtX6mH3_al-rcIluhCXWeNAE2iJKRmrlZDNmHANTk0OknphgDbVDwPBA6rWIVEEQum8Hday5fqsFg4x6BAnAbhI-0My2G8QCyCJDSvpWU6IX0xznZ3DbT8oS7X31UB8OhU7b6H1GISRtqpelct1ttLn36T-yNzu2XN_UiNE4C0
Component: 7
eyJhbGciOiAiUlMyNTYifQ.eyJvYmplY3QiOiBbIjctZjI3MDJjNjExODE3Mjc2YzIyMmIxODIzMGJiNzdhNmZkMjI1MWMxNGY3NGMyODVhZGY0Y2U0ZDU4OGViNDdkMGNiYWQzN2NlOTk3M2QyNGIzYjZhMGFhNjgwNzZmZGEyIiwgIjUwMSIsIDUsIDgsICJiZTIwMjZhMDQxOTkxYzA3ZWNmNTc2OTdkYTEzYmEzZjJkNGNkMjY0MGJlMjBjMzVmYzU2ZjMwYzE4OGY1YWVhIl19.LlNobfCwyx1cTiwU95yRxfB1d22vth56APk3KaAJjtua9f4TN1d2yxRD5MuJOqluHCFAr9uoaWSKA8q3-U1TA0KfxuerwZ6Mh6dkOaDKF1mWTJGJe67hceKaWT4XwwbB3bAcxQv5tbIfuSUZaW1ZR-zMkk0AOjUnDRGaZT6hFB4
Component: 8
eyJhbGciOiAiUlMyNTYifQ.eyJvYmplY3QiOiBbIjgtODUxNDI3MjUyMWU2NjU2MmJhMGM3YjlmM2ViNTA4NjgxNjlhMWNhZjhmZGFjZjQ0MjI2MzE5MzI1YjlkZTJkZGZhMzk2YzA0ZmFkM2VlOTU0NDY0YjYxZjVmZDU2YTFkIiwgIjUwMSIsIDUsIDgsICJlNjRhNTBmOTcyODBhM2FhZGY4N2JlY2VjOTFmMDU5M2NlZjEyY2I1N2Y2YzY5MzI0YjU4ZTZlNjA0YTc2YWQ0Il19.vJ80mnQ6uU9aDRDIbdwc9TPOBLudr9C33MsYFq1erwTaWz8UqRGzLHPUtYXFZDhM7YJ0QY0Sj_cjHitr65mKCIevmAjTZfKsrQL0oYMgWzj4DZmv06V7esaQ725sro3LuONVqwJb8mROThGsqyTHFfCdp8JqgC-nM6XK7pQRRq4

```

#### Descodificar o segredo
De forma a decifrar o segredo, como na execução indicamos que com apenas 5 componentes será possível recuperar a mensagem original, o grupo decidiu executar a script ***```recoverSecretFromComponents-app.py```***.
```
python recoverSecretFromComponents-app.py 5 501 mykey.crt
Component 1: eyJhbGciOiAiUlMyNTYifQ.eyJvYmplY3QiOiBbIjEtYmFmZDc5YjE5MmY1ZDY5Y2U3NGVkNmU4MzhlOTY5ODgwZTFiZDNjMmQ1NTY1ODRjMmViODM5Y2QyMGY1YmM0YTRkOGY5MmE3NWJkZTUyMzMwMTNkMzM0ZDFiMzYwZDdkIiwgIjUwMSIsIDUsIDgsICIwZDA5YTNlNWEzNjFhYzA2MzJkMDM3NzhiOTcyNzQ3OTVhMmM4ZDJhMzM3ZDM5ODE4NTkyOWQ4ZTNiMWRkZjhiIl19.wAqoYNCZsV1q3-lqBqNzYB3QuRIPJSZyA8EKI0yxUV3nBlbaKtipvGRV0XQga6Fy1U-yNsZY08Pul-vBFcdN5IfsLnRaOnuoyjQfPXQ9v5B6kKKj7Jj_doC_FpWzciIoYQNHJhO19lq3VbYVm-i3o_FyRLnGvtiLLVTyZ-5PjU0
Component 2: eyJhbGciOiAiUlMyNTYifQ.eyJvYmplY3QiOiBbIjItOWIxNzkwMGFiZDJlYTJmOWRlNDQ2N2U2ZDg1ZmM3ZWM0NWU4YzdiZjQzM2U4NGFiZDY1ZjJjZjJlMDFlZmFhZTJiNWVmNWE1YTM5ZmM4YmRmMjRhZmFmNzM5ZjdjN2M3IiwgIjUwMSIsIDUsIDgsICJmNTU5YTUzNWU2NGY5YzA0ZjE5MGY2NmMwZjczNTQyNzcyMTg3NDA3ZGI2NzQyNWJlMjg1ZjU4OGI2Y2E4MGE5Il19.vKhPraJPs0nCRo7ccZXSYLPNNI90j8hm6TY_MKqvOsnmVrtTW_rloexqtZ5wY1rCd5RWpPLTZ9QalwBIDj5yGXF4nZnW4a-aVVvzcoOAbjeb3UtC9qWVNvIRssgjs5avqAkdJI4abfer8vHWOOXyB3wHKGxSzcyTJbY7QTiCjxo
Component 3: eyJhbGciOiAiUlMyNTYifQ.eyJvYmplY3QiOiBbIjMtZGI4YWQ0NzA3MGIzNWZlNGM3YTBhZTNlMDY5NDE1OTExM2I2YzJhNzZlMTI1NmUwNTcwOTNjYzhmYzE4MDk3ZmQxNzgyYmUwNTkzZDc1MGU4YzBlZTlmNDIwYTUyOWU2IiwgIjUwMSIsIDUsIDgsICJhODdlNWNhOTRkYjZjYjFjMjE2OWFlNmNjM2RiOGI3NDEwZjIyY2Y2OTllZGY3ODNkZGNhNjY4ODlkY2U3Y2Q3Il19.FzhGt90Kel9SHlcY4yXWkJ_Ghzf4YpqK2lwoK5y-ULyJEobDHv0LOO4nY7Am5ZI0SLyJ4q7Tcs_jZNn82KwBIrPFxmws7bKGzFzLisW5YIrOLqLkvO_4NIlfPXh8rgYq3jY9qHsKHvnCAZrXSy4-5nFqpNSp8v_XSv5nWbRSYGE
Component 4: eyJhbGciOiAiUlMyNTYifQ.eyJvYmplY3QiOiBbIjQtMWNmMTlhYmVhNjA3ODRhMmE0MzY1YWZjYmRhNjU2ZTM2OTZlNGY0MTc4NmVjYWUwNjRjM2ZlOTE2MGJlNDgzMjY3MjIyMGNkZmZiOGUzMDUzZWQwNGQzZmJkZmVmNWVlIiwgIjUwMSIsIDUsIDgsICI2ZGM1MDAxMDlhNWYzOTY5ZjcxMzlkYTAxOTNhZGZmOWNlYWYwMDYxZWY2Y2NjYzEyM2FmMDBlOWI0ZmRkNzViIl19.ck4uDZaj0NedxbG6R15W7yEFORzTciX20dMdCC7VoNtEgv4ool-D0V4DhnehPSMvjuwjtUwrXCRXezjpBVGIPBpsMAM_8ALaeXzrOa9rLAzAMqsvqLt40THE-yHipKVRGoRoDGSTooto3GeE0R7oCXth_XR7-8a0NcRCgdzP-AA
Component 5: eyJhbGciOiAiUlMyNTYifQ.eyJvYmplY3QiOiBbIjUtYTZhYjY4YmFiZDQ5Nzk1NTAwNWE0ODFmM2YxMmJhY2MyM2Y4MGVjY2U3YTMyNzNkODAwYWFiZGQ5NDkxOTRiZDcxNTUwZDk2N2U4Yjg3NWI5YjljOTE0YThlOTAxYmQ1IiwgIjUwMSIsIDUsIDgsICIyMzY1NzFmMTk5ZTUzMDAwMTY4Y2IzYTk4MDI0MjRmYWZiZjFiNjNhMDZjZTkzOTE2Y2JhYTMxZjIxMmUyMTg2Il19.JRn5T2MA0KVfsuKARodFUhLP68b8CwcHQzHasSy6LW7ptC_PMrsag9HTNPORKzepq4ktWMpt0KCCOUJW6HpgUPT7zuNVneWgd8aOfrBQHr1lC809CnpN3pjg_JqP9H-8sNWdns17DYmkcTYTvAimOHSrNDfjj4LMH9ktSSWMLe4
Recovered secret: Agora temos um segredo extremamente confidencial%
```

### Conclusão do Exercício
 Como esperado, ***apenas com a inserção de 5 componentes*** foi possível a reconstituição da mensagem original.  

## Exercício 2.1 B)

O objetivo deste exercício é explicar as diferenças entre a script ***recoverSecretFromComponents-app.py*** e ***recoverSecretFromAllComponents-app.py***.  
Como demonstrado na alínea anterior, uma execução sobre ***recoverSecretFromComponents-app.py*** permite a reconstituição da mensagem original apenas a presença das componentes decrita pelo ***quorum***. Desta forma, a reconstituição da mensagem é possível ***sem a presença de todas as componentes***.  
Por outro lado, a script ***recoverSecretFromAllComponents-app.py*** obriga a ***presença de todas as componentes*** de modo a descodificar a mensagem. Caso seja efectuada uma tentativa de descodificar a mensagem de acordo com o número descrito pelo ***quorum***, a ***mensagem não será decifrada***. 

#### Exemplificação
![diagram](https://github.com/joaocosteira/seguranca_tp1/blob/master/ex2/screenshoots/b.png)

Como podemos observar, ***só com a presença de todas as componentes é possível a descodificação*** da mensagem original. Mesmo com a presença das componentes igual ao número indicado pelo ***quorum***, não é possível a descodificação.  
